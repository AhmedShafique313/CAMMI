<!DOCTYPE html>
<html>
  <head>
    <title>Select Your Plan</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://js.stripe.com/v3/"></script>
  </head>
  <body>
    <h1 class="title">Choose Your Subscription Plan</h1>
    <section class="pricing">

      <!-- Starter Plan -->
      <div class="plan-card">
        <h3>Starter / Lite</h3>
        <p class="desc">Core docs (GTM, ICP), basic edits, small-scale scheduling</p>
        <h2 class="price">$75<span>/month</span></h2>
        <button class="subscribe-btn" data-lookup="starter_lite">Subscribe</button>
      </div>

      <!-- Growth Plan -->
      <div class="plan-card">
        <h3>Growth</h3>
        <p class="desc">Strategy + brand + content + campaign modules</p>
        <h2 class="price">$300<span>/month</span></h2>
        <button class="subscribe-btn" data-lookup="growth_monthly">Subscribe</button>
      </div>

      <!-- Pro Plan -->
      <div class="plan-card popular">
        <h3>Pro <span class="badge">Most Popular</span></h3>
        <p class="desc">All modules, higher volume, priority support</p>
        <h2 class="price">$900<span>/month</span></h2>
        <button class="subscribe-btn" data-lookup="pro_monthly">Subscribe</button>
      </div>

      <!-- Enterprise Plan -->
      <div class="plan-card">
        <h3>Scale / Enterprise</h3>
        <p class="desc">Heavy use, custom modules, API access, white glove support</p>
        <h2 class="price">$2400<span>/month</span></h2>
        <button class="subscribe-btn" data-lookup="scale_enterprise">Subscribe</button>
      </div>

    </section>

    <script>
      const API_GATEWAY = "https://o3uzr46ro5.execute-api.us-east-1.amazonaws.com/cammi-dev/checkout-plans";

      document.querySelectorAll(".subscribe-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
          const lookup_key = btn.getAttribute("data-lookup");

          try {
            const response = await fetch(API_GATEWAY, {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({ lookup_key })
            });

            const data = await response.json();

            if (data.checkout_url) {
              // Redirect to Stripe checkout
              window.location.href = data.checkout_url;
            } else {
              alert("Error: " + JSON.stringify(data));
            }
          } catch (err) {
            console.error(err);
            alert("Failed to create checkout session. Check console for details.");
          }
        });
      });
    </script>
  </body>
</html>
